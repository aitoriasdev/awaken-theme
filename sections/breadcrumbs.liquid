{% comment %}
  Breadcrumb navigation for Shopify Horizon theme (Liquid).
  Includes accessible HTML and JSON-LD structured data.
{% endcomment %}
{% unless template == 'index' or template == 'cart' or template == '404' or template == 'list-collections' %}
  <div class="section section--{{ section.settings.section_width }}">
    <nav class="breadcrumbs" role="navigation" aria-label="{{ 'breadcrumbs.home' | t}}">
      <ol class="breadcrumbs__list">

        <!-- Home -->
        <li class="breadcrumbs__item">
          <a href="{{ routes.root_url }}" class="breadcrumbs__link">
            {{ 'breadcrumbs.home' | t}}
          </a>
        </li>

        {% if template contains 'collection' %}
          {% assign breadcrumb_collections = collection.metafields.custom.breadcrumb_collections.value %}

          {% if breadcrumb_collections != blank %}
            {% for bc in breadcrumb_collections %}
              <li class="breadcrumbs__item">
                <a href="{{ bc.url }}" class="breadcrumbs__link">
                  {{ bc.title }}
                </a>
              </li>
            {% endfor %}
          {% endif %}

          <li class="breadcrumbs__item" aria-current="page">
            {{ collection.title }}
          </li>

        {% elsif template contains 'product' %}
          {% assign breadcrumb_collections = product.metafields.custom.breadcrumb_collections.value %}

          {% if breadcrumb_collections != blank %}
            {% for bc in breadcrumb_collections %}
              <li class="breadcrumbs__item">
                <a href="{{ bc.url }}" class="breadcrumbs__link">
                  {{ bc.title }}
                </a>
              </li>
            {% endfor %}
          {% elsif collection %}
            <li class="breadcrumbs__item">
              <a href="{{ collection.url }}" class="breadcrumbs__link">
                {{ collection.title }}
              </a>
            </li>
          {% endif %}

          <!-- Product -->
          <li class="breadcrumbs__item" aria-current="page">
            {{ product.title }}
          </li>

        {% elsif template contains 'page' %}
          <!-- Static Page -->
          <li class="breadcrumbs__item" aria-current="page">
            {{ page.title }}
          </li>

        {% elsif template contains 'blog' %}
          <!-- Blog -->
          <li class="breadcrumbs__item" aria-current="page">
            {{ blog.title }}
          </li>

        {% elsif template contains 'article' %}
          <!-- Blog Article -->
          <li class="breadcrumbs__item">
            <a href="{{ blog.url }}" class="breadcrumbs__link">
              {{ blog.title }}
            </a>
          </li>
          <li class="breadcrumbs__item" aria-current="page">
            {{ article.title }}
          </li>
        {% endif %}
      </ol>
    </nav>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": {{ 'breadcrumbs.home' | t | json }},
            "item": {{ routes.root_url | json }}
          }
          {% if template contains 'collection' %}
            {% assign breadcrumb_collections = collection.metafields.custom.breadcrumb_collections.value %}
            
            {% if breadcrumb_collections != blank %}
              {% for bc in breadcrumb_collections %}
                ,{
                  "@type": "ListItem",
                  "position": {{ forloop.index | plus: 1 }},
                  "name": {{ bc.title | json }},
                  "item": {{ bc.url | json }}
                }
              {% endfor %}
              ,{
                "@type": "ListItem",
                "position": {{ breadcrumb_collections.size | plus: 2 }},
                "name": {{ collection.title | json }},
                "item": {{ collection.url | json }}
              }
            {% else %}
              ,{
                "@type": "ListItem",
                "position": 2,
                "name": {{ collection.title | json }},
                "item": {{ collection.url | json }}
              }
            {% endif %}
          {% elsif template contains 'product' %}
            {% assign breadcrumb_collections = product.metafields.custom.breadcrumb_collections.value %}
            
            {% if breadcrumb_collections != blank %}
              {% for bc in breadcrumb_collections %}
                ,{
                  "@type": "ListItem",
                  "position": {{ forloop.index | plus: 1 }},
                  "name": {{ bc.title | json }},
                  "item": {{ bc.url | json }}
                }
              {% endfor %}
              ,{
                "@type": "ListItem",
                "position": {{ breadcrumb_collections.size | plus: 2 }},
                "name": {{ product.title | json }},
                "item": {{ product.url | json }}
              }
            {% elsif collection %}
              ,{
                "@type": "ListItem",
                "position": 2,
                "name": {{ collection.title | json }},
                "item": {{ collection.url | json }}
              }
              ,{
                "@type": "ListItem",
                "position": 3,
                "name": {{ product.title | json }},
                "item": {{ product.url | json }}
              }
            {% else %}
              ,{
                "@type": "ListItem",
                "position": 2,
                "name": {{ product.title | json }},
                "item": {{ product.url | json }}
              }
            {% endif %}
          {% elsif template contains 'page' %}
            ,{
              "@type": "ListItem",
              "position": 2,
              "name": {{ page.title | json }},
              "item": {{ page.url | json }}
            }
          {% elsif template contains 'blog' %}
            ,{
              "@type": "ListItem",
              "position": 2,
              "name": {{ blog.title | json }},
              "item": {{ blog.url | json }}
            }
          {% elsif template contains 'article' %}
            ,{
              "@type": "ListItem",
              "position": 2,
              "name": {{ blog.title | json }},
              "item": {{ blog.url | json }}
            }
            ,{
              "@type": "ListItem",
              "position": 3,
              "name": {{ article.title | json }},
              "item": {{ article.url | json }}
            }
          {% endif %}
        ]
      }
    </script>
  </div>
{% endunless %}

{% stylesheet %}
  .breadcrumbs {
    color: var(--color-foreground);
    font-size: 1rem;
    font-weight: 500;
    margin-block: 2rem;
  }

  .breadcrumbs__list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .breadcrumbs__item {
    align-items: center;
    display: flex;
  }

  .breadcrumbs__item::after {
    color: var(--color-foreground);
    content: "â€º";
    margin-left: 0.5rem;
    margin-right: 0.5rem;
  }

  .breadcrumbs__item:last-child::after {
    content: "";
    margin: 0;
  }

  .breadcrumbs__link {
    color: var(--color-primary);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .breadcrumbs__link:hover {
    color: var(--color-primary-hover);
    text-decoration: underline;
  }

  .breadcrumbs__link[aria-current="page"] {
    color: var(--color-foreground);
    cursor: default;
    pointer-events: none;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.breadcrumbs",
  "settings": [
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.section_width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "t:names.breadcrumbs_section",
      "category": "t:categories.layout"
    }
  ]
}
{% endschema %}
